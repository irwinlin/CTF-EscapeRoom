<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Animated Security Room</title>
  <!-- Google Font for the handwritten look -->
  <link href="https://fonts.googleapis.com/css2?family=Indie+Flower&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.min.js"></script>
  <style>
    body { margin: 0; }
  </style>
</head>
<body>
<script>
class FlickerBackgroundScene extends Phaser.Scene {
  constructor() {
    super("FlickerBackgroundScene");
  }

  preload() {
    // Load your background images and keypad image.
    this.load.image("darkRoom", "assets/DarkRoom1.png");
    this.load.image("lightRoom", "assets/LightRoom1.png");
    this.load.image("keypad",   "assets/kaypad.png");  // Adjust path/filename if needed
  }

  create() {
    // Track door unlock status.
    this.doorUnlocked = false;

    // Create two full-screen background images.
    this.bgDark = this.add.image(this.cameras.main.width / 2, this.cameras.main.height / 2, "darkRoom")
      .setOrigin(0.5)
      .setDisplaySize(this.cameras.main.width, this.cameras.main.height);

    this.bgLight = this.add.image(this.cameras.main.width / 2, this.cameras.main.height / 2, "lightRoom")
      .setOrigin(0.5)
      .setDisplaySize(this.cameras.main.width, this.cameras.main.height);

    // Dark visible, light invisible initially.
    this.bgDark.setAlpha(1);
    this.bgLight.setAlpha(0);

    // Start flicker loop.
    this.scheduleFlicker();

    // Define interactive areas.
    this.interactiveAreas = [
      { id: "leftDeskMonitor", coords: [0.27, 0.53, 0.36, 0.65] },
      { id: "middleDeskMonitor", coords: [0.39, 0.53, 0.49, 0.65] },
      { id: "rightDeskMonitor", coords: [0.51, 0.53, 0.61, 0.65] },
      { id: "leftTopMonitor", coords: [0.26, 0.3, 0.41, 0.5] },
      { id: "rightTopMonitor", coords: [0.42, 0.3, 0.58, 0.5] },
      { id: "door", coords: [0.63, 0.42, 0.75, 0.83] },
      { id: "doorKeypad", coords: [0.63, 0.60, 0.65, 0.66] },
      { id: "garbageCan", coords: [0.15, 0.85, 0.2, 0.95] }
    ];

    // Create interactive boxes for each area.
    this.interactiveBoxes = [];
    this.interactiveAreas.forEach(area => {
      // For garbageCan & door, make the box invisible (alpha=0).
      let alpha = 0.4;
      if (area.id === "garbageCan" || area.id === "door") {
        alpha = 0;
      }
      let box = this.add.rectangle(0, 0, 10, 10, 0xffffff, alpha)
        .setOrigin(0.5)
        .setInteractive()
        .setName(area.id);
      // For doorKeypad, ensure it's above the door.
      if (area.id === "doorKeypad") {
        box.setDepth(10);
      } else if (area.id === "door") {
        box.setDepth(1);
      }
      // On pointerdown, call areaClicked with the area id.
      box.on("pointerdown", () => this.areaClicked(area.id));
      this.interactiveBoxes.push({ id: area.id, box: box, coords: area.coords });
    });

    // Level counter (bottom left).
    this.levelCounter = this.add.text(20, this.cameras.main.height - 20, "Level 1", {
      font: "20px 'Indie Flower'",
      fill: "#ffffff"
    }).setOrigin(0, 1).setDepth(3);

    // Instructions text (top right).
    this.instructions = this.add.text(this.cameras.main.width - 20, 40, "Monitors\nTrash Can\nDoor\nKeypad", {
      font: "18px 'Indie Flower'",
      fill: "#ffffff",
      align: "right"
    }).setOrigin(1, 0).setDepth(3).setVisible(false);

    // Hint button (top right).
    this.hintButton = this.add.text(this.cameras.main.width - 20, 10, "Hint", {
      font: "18px 'Indie Flower'",
      fill: "#ffff00"
    }).setOrigin(1, 0).setDepth(5).setInteractive({ useHandCursor: true });
    this.hintButton.on("pointerdown", () => {
      this.instructions.setVisible(!this.instructions.visible);
      if (this.instructions.visible) {
        this.hint2Button.setVisible(true);
      } else {
        this.hint2Button.setVisible(false);
        this.extraInstructions.setVisible(false);
      }
    });

    // Hint 2 button, at y=140, hidden initially.
    this.hint2Button = this.add.text(this.cameras.main.width - 20, 140, "Hint 2", {
      font: "18px 'Indie Flower'",
      fill: "#ffff00"
    }).setOrigin(1, 0).setDepth(5).setInteractive({ useHandCursor: true }).setVisible(false);
    this.hint2Button.on("pointerdown", () => {
      this.extraInstructions.setVisible(!this.extraInstructions.visible);
    });

    // Extra instructions text, at y=180, hidden initially.
    this.extraInstructions = this.add.text(this.cameras.main.width - 20, 180,
      "Left/Middle/Right Desk Monitors: View feeds\n" +
      "Wall Monitors: Display info\n" +
      "Door: Click for message\n" +
      "Keypad: Enter password\n" +
      "Garbage Can: Reveal sticky note", {
        font: "16px 'Indie Flower'",
        fill: "#ffffff",
        align: "right"
      }
    ).setOrigin(1, 0).setDepth(5).setVisible(false);

    // A dark overlay for the sticky note.
    this.overlay = this.add.rectangle(this.cameras.main.width / 2, this.cameras.main.height / 2,
      this.cameras.main.width, this.cameras.main.height, 0x000000, 0.5)
      .setOrigin(0.5).setDepth(2).setVisible(false);

    // Sticky note for the garbage can, 300x300.
    this.stickyNote = this.add.text(this.cameras.main.width / 2, this.cameras.main.height / 2,
      "Username: user\nPassword: secret", {
        font: "24px 'Indie Flower'",
        fill: "#000000",
        backgroundColor: "#ffff88",
        padding: { x: 20, y: 20 },
        align: "center"
      }
    ).setFixedSize(300, 300).setOrigin(0.5).setVisible(false).setDepth(3).setInteractive({ useHandCursor: true });
    this.stickyNote.on("pointerdown", () => {
      // Hide sticky note & overlay if the note is clicked.
      this.stickyNote.setVisible(false);
      this.overlay.setVisible(false);
    });

    // Door message text.
    this.doorMessage = this.add.text(0, 0, "", {
      font: "20px 'Indie Flower'",
      fill: "#ffffff"
    }).setOrigin(0.5).setDepth(4).setVisible(false);

    // If the sticky note is open, clicking anywhere else closes it.
    this.input.on("pointerdown", (pointer, currentlyOver) => {
      if (this.stickyNote.visible) {
        if (!currentlyOver.some(obj => obj.name === "garbageCan")) {
          this.stickyNote.setVisible(false);
          this.overlay.setVisible(false);
        }
      }
    });

    // Immediately resize for correct initial layout.
    this.resize({ width: this.cameras.main.width, height: this.cameras.main.height });
    // Listen for window resizing.
    this.scale.on('resize', this.resize, this);
  }

  scheduleFlicker() {
    let delay = Phaser.Math.Between(1000, 3000);
    this.time.delayedCall(delay, () => this.startFlicker());
  }
  
  startFlicker() {
    let flickerDuration = Phaser.Math.Between(100, 500);
    this.bgLight.setAlpha(1);
    this.bgDark.setAlpha(0);
    this.time.delayedCall(flickerDuration, () => {
      this.bgLight.setAlpha(0);
      this.bgDark.setAlpha(1);
      this.scheduleFlicker();
    });
  }

  areaClicked(id) {
    console.log("Clicked area:", id);

    if (id === "garbageCan") {
      // Show sticky note with overlay.
      this.overlay.setAlpha(0);
      this.overlay.setVisible(true);
      this.tweens.add({
        targets: this.overlay,
        alpha: 0.5,
        duration: 300
      });
      this.stickyNote.setAlpha(0);
      this.stickyNote.setVisible(true);
      this.tweens.add({
        targets: this.stickyNote,
        alpha: 1,
        duration: 300
      });

    } else if (id === "door") {
      // Show door locked/unlocked message over the door.
      const doorBox = this.interactiveBoxes.find(item => item.id === "door");
      if (doorBox) {
        this.doorMessage.setPosition(doorBox.box.x, doorBox.box.y);
      }
      this.doorMessage.setText(
        this.doorUnlocked
          ? "Door unlocked!"
          : "Door locked! Enter the keypad password to unlock the door."
      );
      this.doorMessage.setVisible(true);
      this.time.delayedCall(3000, () => {
        this.doorMessage.setVisible(false);
      });

    } else if (id === "doorKeypad") {
      // Switch background to keypad.png, fill the screen.
      this.bgDark.setTexture("keypad");
      this.bgDark.setDisplaySize(this.cameras.main.width, this.cameras.main.height);

      // Let Phaser repaint first, then show prompt.
      this.time.delayedCall(100, () => {
        let input = window.prompt("Enter the keypad password:");
        if (input !== null) {
          if (input === "1234") {
            this.doorUnlocked = true;
            this.showDoorMessage("Door unlocked!");
          } else {
            this.showDoorMessage("Incorrect password!");
          }
        }
        // Revert background to darkRoom after the prompt.
        this.bgDark.setTexture("darkRoom");
        this.bgDark.setDisplaySize(this.cameras.main.width, this.cameras.main.height);
      });
    }
    // Additional monitor interactions can be added here.
  }

  showDoorMessage(msg) {
    // Show a message over the door for 3 seconds.
    const doorBox = this.interactiveBoxes.find(item => item.id === "door");
    if (doorBox) {
      this.doorMessage.setPosition(doorBox.box.x, doorBox.box.y);
    }
    this.doorMessage.setText(msg).setVisible(true);
    this.time.delayedCall(3000, () => {
      this.doorMessage.setVisible(false);
    });
  }

  resize(gameSize) {
    let { width, height } = gameSize;
    this.cameras.resize(width, height);

    // Resize backgrounds.
    this.bgDark.setPosition(width / 2, height / 2).setDisplaySize(width, height);
    this.bgLight.setPosition(width / 2, height / 2).setDisplaySize(width, height);

    // Resize overlay.
    this.overlay.setPosition(width / 2, height / 2).setSize(width, height);

    // Recalc positions for interactive boxes.
    this.interactiveBoxes.forEach(item => {
      const [x_min, y_min, x_max, y_max] = item.coords;
      let boxWidth = (x_max - x_min) * width;
      let boxHeight = (y_max - y_min) * height;
      let x = x_min * width + boxWidth / 2;
      let y = y_min * height + boxHeight / 2;
      item.box.setPosition(x, y).setSize(boxWidth, boxHeight);
    });

    // Update level counter, instructions, hints, etc.
    this.levelCounter.setPosition(20, height - 20);
    this.hintButton.setPosition(width - 20, 10);
    this.hint2Button.setPosition(width - 20, 140);
    this.instructions.setPosition(width - 20, 40);
    this.extraInstructions.setPosition(width - 20, 180);

    // Reposition sticky note if visible.
    this.stickyNote.setPosition(width / 2, height / 2);

    // Reposition door message if visible.
    if (this.doorMessage.visible) {
      const doorBox = this.interactiveBoxes.find(item => item.id === "door");
      if (doorBox) {
        this.doorMessage.setPosition(doorBox.box.x, doorBox.box.y);
      }
    }
  }
}

const config = {
  type: Phaser.AUTO,
  width: window.innerWidth,
  height: window.innerHeight,
  scene: [FlickerBackgroundScene],
  scale: {
    mode: Phaser.Scale.RESIZE,
    autoCenter: Phaser.Scale.CENTER_BOTH
  }
};

new Phaser.Game(config);
</script>
</body>
</html>

<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Responsive Security Room</title>
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.min.js"></script>
</head>
<body>
  <script>
    class SecurityRoomScene extends Phaser.Scene {
      constructor() {
        super("SecurityRoomScene");
      }
      
      preload() {
        // Load the door images and background.
        this.load.image('closeDoor', 'assets/closeDoor.png');
        this.load.image('openDoor', 'assets/openDoor.png');  // Open door texture
        this.load.image('room', 'assets/brick.png');
      }
      
      create() {
        // Flags.
        this.credentialsCorrect = false;
        this.doorIsOpen = false;
        
        // Create background.
        this.background = this.add.image(0, 0, 'room');
        
        // Create dynamic textures for other elements.
        // Monitor texture: base size 100x70.
        const monitorGraphics = this.add.graphics();
        monitorGraphics.fillStyle(0x808080, 1);
        monitorGraphics.fillRect(0, 0, 100, 70);
        monitorGraphics.fillStyle(0xffffff, 1);
        monitorGraphics.fillRect(10, 10, 80, 50);
        monitorGraphics.generateTexture('monitorTexture', 100, 70);
        monitorGraphics.destroy();
        
        // Trash bin texture: base size 60x80.
        const trashGraphics = this.add.graphics();
        trashGraphics.fillStyle(0x303030, 1);
        trashGraphics.fillRect(0, 0, 60, 80);
        trashGraphics.fillStyle(0x606060, 1);
        trashGraphics.fillRect(0, 0, 60, 10);
        trashGraphics.generateTexture('trashTexture', 60, 80);
        trashGraphics.destroy();
        
        // Chair texture: base size 80x120.
        const chairGraphics = this.add.graphics();
        chairGraphics.fillStyle(0xA0522D, 1);
        chairGraphics.fillRect(0, 0, 80, 40);
        chairGraphics.fillRect(0, 40, 80, 80);
        chairGraphics.generateTexture('chairTexture', 80, 120);
        chairGraphics.destroy();
        
        // Table texture: base size 300x50.
        const tableGraphics = this.add.graphics();
        tableGraphics.fillStyle(0x8B4513, 1);
        tableGraphics.fillRect(0, 0, 300, 20);
        tableGraphics.fillRect(10, 20, 10, 30);
        tableGraphics.fillRect(280, 20, 10, 30);
        tableGraphics.generateTexture('tableTexture', 300, 50);
        tableGraphics.destroy();
        
        // ----- Create Scene Elements -----
        // Table.
        this.table = this.add.image(0, 0, 'tableTexture');
        this.table.setDepth(2);
        
        // Monitors.
        this.monitors = [];
        for (let i = 0; i < 3; i++) {
          let monitor = this.add.image(0, 0, 'monitorTexture').setInteractive();
          monitor.setDepth(3);
          monitor.name = `Monitor ${i+1}`;
          monitor.on('pointerdown', () => {
            this.promptForCredentials();
          });
          this.monitors.push(monitor);
        }
        
        // Door – start with the closed door image.
        this.door = this.add.image(0, 0, 'closeDoor').setInteractive();
        this.door.setDepth(3);
        this.door.name = "Door";
        this.door.on('pointerdown', () => {
          if (this.credentialsCorrect) {
            if (!this.doorIsOpen) {
              this.door.setTexture('openDoor');
              this.doorIsOpen = true;
              this.showMessage("Door opened! Move on...");
            } else {
              this.showMessage("Door is already open!");
            }
          } else {
            this.showMessage("Door locked! Complete task to move on...");
          }
        });
        
        // Chair.
        this.chair = this.add.image(0, 0, 'chairTexture');
        this.chair.setDepth(3);
        
        // Trash bin.
        this.trashBin = this.add.image(0, 0, 'trashTexture').setInteractive();
        this.trashBin.setDepth(1);
        this.trashBin.name = "Trash Bin";
        this.trashBin.on('pointerdown', () => {
          this.showHint("Username: user\nPassword: pass");
        });
        
        // Floor: a rectangle representing the floor.
        this.floor = this.add.rectangle(0, 0, 100, 50, 0x654321).setOrigin(0.5, 0);
        this.floor.setDepth(0);
        
        // Message text.
        this.messageText = this.add.text(20, 20, "Click a monitor, door, or trash bin.", { font: "20px Arial", fill: "#ffffff" });
        
        // Hint text (sticky note style), hidden initially.
        this.hintText = this.add.text(this.cameras.main.width / 2, this.cameras.main.height * 0.2, "", {
          font: "20px Arial",
          fill: "#000000",
          backgroundColor: "#ffff88",
          padding: { x: 10, y: 10 }
        });
        this.hintText.setOrigin(0.5);
        this.hintText.setVisible(false);
        
        // Update layout initially and on window resize.
        this.updateLayout();
        this.scale.on('resize', this.updateLayout, this);
      }
      
      promptForCredentials() {
        if (!this.credentialsCorrect) {
          let username = window.prompt("Enter username:");
          if (username !== null) {
            let password = window.prompt("Enter password:");
            if (password !== null) {
              if (username === "user" && password === "pass") {
                this.credentialsCorrect = true;
                this.showMessage("Credentials accepted! Door unlocked.");
              } else {
                this.showMessage("Invalid credentials!");
              }
            }
          }
        } else {
          this.showMessage("Credentials already accepted! Door unlocked.");
        }
      }
      
      updateLayout() {
        let gameWidth = this.scale.width;
        let gameHeight = this.scale.height;
        
        // Center the background.
        this.background.setPosition(gameWidth / 2, gameHeight / 2);
        
        // --- Compute Scale Factors ---
        let tableScale = (gameWidth * 0.5) / 300;
        this.table.setScale(tableScale);
        
        let monitorScale = (gameWidth * 0.12) / 100;
        this.monitors.forEach(monitor => monitor.setScale(monitorScale));
        
        let chairScale = (gameWidth * 0.10) / 80;
        this.chair.setScale(chairScale);
        
        let trashScale = (gameWidth * 0.05) / 60;
        this.trashBin.setScale(trashScale);
        
        let doorScale = (gameWidth * 0.2) / 80;
        this.door.setScale(doorScale);
        // If the door is not open, ensure it shows the closed texture.
        if (!this.doorIsOpen) {
          this.door.setTexture('closeDoor');
        }
        
        // Floor: set the floor width to match gameWidth.
        this.floor.setSize(gameWidth, 50);
        
        // --- Position Elements ---
        // Table: bottom center at 75% of game height.
        let tableX = gameWidth / 2;
        let tableY = gameHeight * 0.75;
        this.table.setPosition(tableX, tableY);
        let tableDisplayWidth = this.table.displayWidth;
        let tableDisplayHeight = this.table.displayHeight;
        let tableBottomY = tableY + tableDisplayHeight / 2;
        
        // Monitors: position so their bottom aligns with the top of the table.
        let monitorHeight = 70 * monitorScale;
        let tableTopY = tableY - tableDisplayHeight / 2;
        let monitorY = tableTopY - monitorHeight / 2;
        let monitorLeftX = tableX - tableDisplayWidth / 2 + tableDisplayWidth * 0.25;
        let monitorCenterX = tableX;
        let monitorRightX = tableX + tableDisplayWidth / 2 - tableDisplayWidth * 0.25;
        this.monitors[0].setPosition(monitorLeftX, monitorY);
        this.monitors[1].setPosition(monitorCenterX, monitorY);
        this.monitors[2].setPosition(monitorRightX, monitorY);
        
        // Door: position the door so that its bottom aligns with the bottom of the table.
        // Compute doorY from tableBottomY.
        let doorDisplayHeight = this.door.displayHeight;
        let doorY = tableBottomY - doorDisplayHeight / 2;
        // Keep doorX as before (positioned toward the right).
        let doorMargin = 50;
        let doorX = gameWidth - ((300 * doorScale) / 2) - doorMargin; 
        this.door.setPosition(doorX, doorY);
        
        // Chair: center on the table.
        let chairX = tableX;
        let chairY = tableY;
        this.chair.setPosition(chairX, chairY);
        let chairBottomY = chairY + (this.chair.displayHeight / 2);
        
        // Trash bin: align its bottom with the chair’s bottom.
        let trashY = chairBottomY - (this.trashBin.displayHeight / 2);
        let trashX = chairX + (150 * (gameWidth / 1024));
        this.trashBin.setPosition(trashX, trashY);
        
        // Floor: position the floor so that its top edge touches the table's bottom.
        this.floor.setPosition(gameWidth / 2, tableBottomY);
        
        // Hint text and message text.
        this.hintText.setPosition(gameWidth / 2, gameHeight * 0.2);
        this.messageText.setPosition(20, 20);
      }
      
      showMessage(msg) {
        this.messageText.setText(msg);
        this.time.delayedCall(3000, () => {
          this.messageText.setText("Click a monitor, door, or trash bin.");
        }, [], this);
      }
      
      showHint(msg) {
        this.hintText.setText(msg);
        this.hintText.setVisible(true);
        this.time.delayedCall(3000, () => {
          this.hintText.setVisible(false);
        }, [], this);
      }
    }
    
    const config = {
      type: Phaser.AUTO,
      scale: {
        mode: Phaser.Scale.RESIZE,
        autoCenter: Phaser.Scale.CENTER_BOTH
      },
      scene: [SecurityRoomScene]
    };
    
    const game = new Phaser.Game(config);
  </script>
</body>
</html>
